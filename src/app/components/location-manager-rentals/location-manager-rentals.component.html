<div class="container mt-4">
  <div class="row">
    <div class="col-12">
      <h2 class="mb-2">Lokasyon Kiralama YÃ¶netimi</h2>
      <p class="text-muted mb-4">YÃ¶nettiÄŸiniz lokasyonlardaki tÃ¼m kiralama kayÄ±tlarÄ±</p>

      <!-- Filtre Paneli -->
      <div class="card filter-card mb-4">
        <div class="card-body">
          <h6 class="card-title mb-3">
            <i class="fas fa-filter mr-2"></i> Filtreleme SeÃ§enekleri
            <small class="text-muted font-weight-normal ml-2">â€” Birden fazla filtre aynÄ± anda kullanÄ±labilir</small>
          </h6>

          <!-- Ãœst SatÄ±r: Tarih (sol) | E-Posta (saÄŸ) -->
          <div class="row">
            <!-- SOL: Tarih Filtresi -->
            <div class="col-md-6 border-right-filter">
              <div class="d-flex align-items-center justify-content-between mb-2">
                <span class="filter-section-label">ğŸ“… Kiralama Tarihi</span>
                <!-- Tek tarih / AralÄ±k toggle -->
                <div class="custom-control custom-switch">
                  <input type="checkbox" class="custom-control-input" id="dateRangeToggle" [(ngModel)]="dateRangeMode"
                    (change)="filterDateEnd = ''" />
                  <label class="custom-control-label small" for="dateRangeToggle">Tarih AralÄ±ÄŸÄ± SeÃ§</label>
                </div>
              </div>

              <!-- Tek Tarih Modu -->
              <div *ngIf="!dateRangeMode" class="mt-1">
                <label for="filterDate" class="form-label small text-muted">Kiralama Tarihi</label>
                <input type="date" id="filterDate" class="form-control" [(ngModel)]="filterDate"
                  [disabled]="isLoading || isFiltering" />
              </div>

              <!-- AralÄ±k Modu -->
              <div *ngIf="dateRangeMode" class="mt-1">
                <div class="row">
                  <div class="col-6">
                    <label for="filterDateStart" class="form-label small text-muted">BaÅŸlangÄ±Ã§</label>
                    <input type="date" id="filterDateStart" class="form-control" [(ngModel)]="filterDate"
                      [disabled]="isLoading || isFiltering" />
                  </div>
                  <div class="col-6">
                    <label for="filterDateEnd" class="form-label small text-muted">BitiÅŸ</label>
                    <input type="date" id="filterDateEnd" class="form-control" [(ngModel)]="filterDateEnd"
                      [min]="filterDate" [disabled]="isLoading || isFiltering || !filterDate" />
                  </div>
                </div>
              </div>
            </div>

            <!-- SAÄ: E-Posta Filtresi -->
            <div class="col-md-6 mt-3 mt-md-0">
              <span class="filter-section-label">âœ‰ï¸ E-Posta Adresi</span>
              <div class="mt-2">
                <label for="filterEmail" class="form-label small text-muted">KullanÄ±cÄ± / Kurumsal E-Posta</label>
                <input type="email" id="filterEmail" class="form-control" placeholder="ornek@email.com"
                  [(ngModel)]="filterEmail" [disabled]="isLoading || isFiltering" />
              </div>
            </div>
          </div>

          <hr class="filter-divider mt-3">

          <!-- Alt SatÄ±r: Ä°sim/Åirket Filtresi (sol) -->
          <div class="row">
            <div class="col-md-6">
              <span class="filter-section-label">ğŸ‘¤ Ad Soyad / Åirket AdÄ±</span>
              <div class="mt-2">
                <label for="filterName" class="form-label small text-muted">Ad Soyad veya Åirket AdÄ±</label>
                <input type="text" id="filterName" class="form-control" placeholder="Ahmet YÄ±lmaz veya ABC Ltd."
                  [(ngModel)]="filterName" [disabled]="isLoading || isFiltering" (keyup.enter)="applyFilters()" />
              </div>
            </div>
          </div>

          <!-- Butonlar -->
          <div class="row mt-3">
            <div class="col-12 d-flex align-items-center" style="gap: 0.5rem; flex-wrap: wrap;">
              <button class="btn btn-primary" (click)="applyFilters()" [disabled]="isLoading || isFiltering">
                <span *ngIf="isFiltering" class="spinner-border spinner-border-sm mr-1" role="status"></span>
                <span *ngIf="!isFiltering">ğŸ”</span> Filtrele
              </button>

              <button class="btn btn-outline-secondary" (click)="clearFilter()" [disabled]="isLoading || isFiltering">
                âœ• Temizle
              </button>

              <!-- Aktif filtre etiketleri -->
              <ng-container *ngIf="filterDate">
                <span *ngIf="!dateRangeMode" class="badge filter-badge ml-1">
                  ğŸ“… {{ filterDate | date:'dd.MM.yyyy' }}
                </span>
                <span *ngIf="dateRangeMode" class="badge filter-badge ml-1">
                  ğŸ“… {{ filterDate | date:'dd.MM.yyyy' }}
                  <span *ngIf="filterDateEnd"> â€” {{ filterDateEnd | date:'dd.MM.yyyy' }}</span>
                </span>
              </ng-container>
              <span *ngIf="filterEmail" class="badge filter-badge-email ml-1">
                âœ‰ï¸ {{ filterEmail }}
              </span>
              <span *ngIf="filterName" class="badge filter-badge-name ml-1">
                ğŸ‘¤ {{ filterName }}
              </span>
            </div>
          </div>
        </div>
      </div>

      <!-- Loading Spinner -->
      <div *ngIf="isLoading" class="text-center">
        <div class="spinner-border text-primary" role="status">
          <span class="sr-only">YÃ¼kleniyor...</span>
        </div>
        <p class="mt-2">Kiralama bilgileri yÃ¼kleniyor...</p>
      </div>

      <!-- No Rentals Message -->
      <div *ngIf="!isLoading && filteredRentals.length === 0" class="alert alert-info">
        <h4 class="alert-heading">Kiralama bulunamadÄ±</h4>
        <p class="mb-0">Filtre kriterlerinizi deÄŸiÅŸtirerek tekrar deneyebilirsiniz.</p>
      </div>

      <!-- Rentals List -->
      <div *ngIf="!isLoading && filteredRentals.length > 0" class="row">
        <div class="col-md-6 col-lg-4 mb-4" *ngFor="let rental of filteredRentals">
          <div class="card rental-card h-100">
            <div class="card-img-container">
              <img src="assets/images/lux.jpg" class="card-img-top rental-image" alt="{{ rental.brandName }}"
                (error)="setDefaultImage($event)">
            </div>

            <div class="card-header bg-primary text-white">
              <div class="d-flex justify-content-between align-items-center">
                <h5 class="card-title mb-0">{{ rental.brandName }}</h5>
                <span [class]="'badge ' + getStatusClass(rental.isReturned)">
                  {{ getStatusText(rental.isReturned) }}
                </span>
              </div>
            </div>

            <div class="card-body">
              <div class="rental-info">
                <h6 class="text-primary mb-3">AraÃ§ Bilgileri</h6>
                <p><strong>Model:</strong> {{ rental.modelYear }} {{ rental.brandName }}</p>
                <p><strong>Renk:</strong> {{ rental.colorName }}</p>
                <p><strong>Segment:</strong> {{ rental.segmentName }}</p>
                <p><strong>YakÄ±t:</strong> {{ rental.fuelName }}</p>
                <p><strong>Vites:</strong> {{ rental.gearName }}</p>
                <p><strong>GÃ¼nlÃ¼k Ãœcret:</strong> {{ rental.dailyPrice | currency:'TRY':'symbol' }}</p>
                <p><strong>Depozito:</strong> {{ rental.deposit | currency:'TRY':'symbol' }}</p>

                <hr>

                <div *ngIf="getUserInfo(rental); else loadingUser">
                  <p><strong>Ad Soyad/Åirket:</strong> {{ getUserInfo(rental).name }}</p>
                  <p><strong>Email:</strong> {{ getUserInfo(rental).email }}</p>
                  <p><strong>Telefon:</strong> {{ getUserInfo(rental).phone }}</p>
                  <p><strong>Adres:</strong> {{ getUserInfo(rental).address }}</p>
                  <p *ngIf="getUserInfo(rental).type === 'Individual'">
                    <strong>TC Kimlik:</strong> {{ getUserInfo(rental).identityNumber }}
                  </p>
                  <p *ngIf="getUserInfo(rental).type === 'Corporate'">
                    <strong>Vergi No:</strong> {{ getUserInfo(rental).taxNumber }}
                  </p>
                  <p><strong>Kaynak:</strong> {{ getUserInfo(rental).source === 'User' ? 'KullanÄ±cÄ±' : 'MÃ¼ÅŸteri' }}</p>
                </div>
                <ng-template #loadingUser>
                  <p class="text-muted">KullanÄ±cÄ± bilgileri yÃ¼kleniyor...</p>
                </ng-template>

                <p><strong>KullanÄ±cÄ± ID:</strong> {{ rental.userId }}</p>

                <hr>

                <h6 class="text-primary mb-3">Kiralama Bilgileri</h6>
                <p><strong>Kiralama Tarihi:</strong> {{ formatDate(rental.rentDate) }}</p>
                <p *ngIf="rental.returnDate">
                  <strong>Ä°ade Tarihi:</strong> {{ formatDate(rental.returnDate) }}
                </p>
                <p>
                  <strong>BaÅŸlangÄ±Ã§ Lokasyonu:</strong>
                  <a [routerLink]="['/branches']" [queryParams]="{location: rental.startLocation}"
                    class="location-link">
                    {{ rental.startLocation }}
                  </a>
                </p>
                <p>
                  <strong>BitiÅŸ Lokasyonu:</strong>
                  <a [routerLink]="['/branches']" [queryParams]="{location: rental.endLocation}" class="location-link">
                    {{ rental.endLocation }}
                  </a>
                </p>
                <p><strong>Kiralama ID:</strong> {{ rental.rentalId }}</p>
              </div>
            </div>
            <div class="card-footer bg-light">
              <small class="text-muted">
                AraÃ§ ID: {{ rental.carId }} | Lokasyon: {{ rental.locationName }}
              </small>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>