<!-- Google Fonts: Inter -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

<div class="lm-page">
  <div class="container-xl">

    <!-- â”€â”€ Page Header â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div class="page-header">
      <div class="page-header__eyebrow">
        <svg width="12" height="12" viewBox="0 0 12 12" fill="none">
          <circle cx="6" cy="6" r="5" stroke="currentColor" stroke-width="1.5" />
          <path d="M6 3.5V6.5L7.5 8" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
        </svg>
        Konum YÃ¶neticisi Paneli
      </div>
      <h1 class="page-header__title">Kiralama KayÄ±tlarÄ±</h1>
      <p class="page-header__subtitle">YÃ¶nettiÄŸiniz lokasyonlardaki aktif ve geÃ§miÅŸ kiralama kayÄ±tlarÄ±nÄ± buradan takip
        edebilirsiniz.</p>
    </div>

    <!-- â”€â”€ Filter Panel â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div class="filter-panel">
      <div class="filter-panel__header">
        <span class="filter-panel__title">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"
            stroke-linecap="round" stroke-linejoin="round">
            <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3" />
          </svg>
          GeliÅŸmiÅŸ Filtreleme
        </span>

        <!-- Range toggle in header -->
        <label class="range-toggle" for="dateRangeToggle">
          <input class="range-toggle__input" type="checkbox" id="dateRangeToggle" [(ngModel)]="dateRangeMode"
            (change)="filterDateEnd = ''" />
          <span class="range-toggle__track">
            <span class="range-toggle__thumb"></span>
          </span>
          <span class="range-toggle__label">Tarih AralÄ±ÄŸÄ±</span>
        </label>
      </div>

      <div class="filter-panel__body">
        <div class="filter-grid">

          <!-- Date filter -->
          <div class="filter-field">
            <label class="filter-field__label">ğŸ“… Kiralama Tarihi</label>

            <!-- Single date -->
            <div *ngIf="!dateRangeMode">
              <input type="date" id="filterDate" class="filter-field__input" [(ngModel)]="filterDate"
                [disabled]="isLoading || isFiltering" />
            </div>

            <!-- Date range -->
            <div *ngIf="dateRangeMode" class="date-range-pair">
              <div>
                <label for="filterDateStart" class="filter-field__label"
                  style="font-size:0.68rem; margin-bottom:0.3rem;">BaÅŸlangÄ±Ã§</label>
                <input type="date" id="filterDateStart" class="filter-field__input" [(ngModel)]="filterDate"
                  [disabled]="isLoading || isFiltering" />
              </div>
              <div>
                <label for="filterDateEnd" class="filter-field__label"
                  style="font-size:0.68rem; margin-bottom:0.3rem;">BitiÅŸ</label>
                <input type="date" id="filterDateEnd" class="filter-field__input" [(ngModel)]="filterDateEnd"
                  [min]="filterDate" [disabled]="isLoading || isFiltering || !filterDate" />
              </div>
            </div>
          </div>

          <!-- Email filter -->
          <div class="filter-field">
            <label class="filter-field__label">âœ‰ï¸ E-Posta Adresi</label>
            <input type="email" id="filterEmail" class="filter-field__input" placeholder="ornek@sirket.com"
              [(ngModel)]="filterEmail" [disabled]="isLoading || isFiltering" (keyup.enter)="applyFilters()" />
          </div>

          <!-- Name filter -->
          <div class="filter-field">
            <label class="filter-field__label">ğŸ‘¤ Ad Soyad veya Åirket</label>
            <input type="text" id="filterName" class="filter-field__input" placeholder="Ahmet YÄ±lmaz veya ABC Ltd."
              [(ngModel)]="filterName" [disabled]="isLoading || isFiltering" (keyup.enter)="applyFilters()" />
          </div>

        </div>
      </div>

      <div class="filter-panel__footer">
        <!-- Action buttons -->
        <button class="btn-primary-solid" (click)="applyFilters()" [disabled]="isLoading || isFiltering">
          <svg *ngIf="!isFiltering" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
            stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="11" cy="11" r="8" />
            <line x1="21" y1="21" x2="16.65" y2="16.65" />
          </svg>
          <span *ngIf="isFiltering" class="spinner-ring" style="width:14px;height:14px;border-width:2px;"></span>
          Filtrele
        </button>

        <button class="btn-ghost" (click)="clearFilter()" [disabled]="isLoading || isFiltering">
          <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"
            stroke-linecap="round" stroke-linejoin="round">
            <line x1="18" y1="6" x2="6" y2="18" />
            <line x1="6" y1="6" x2="18" y2="18" />
          </svg>
          Temizle
        </button>

        <!-- Active filter chips -->
        <ng-container *ngIf="filterDate">
          <span *ngIf="!dateRangeMode" class="chip chip--date">
            {{ filterDate | date:'dd MMM yyyy':'':'tr' }}
          </span>
          <span *ngIf="dateRangeMode" class="chip chip--date">
            {{ filterDate | date:'dd MMM':'':'tr' }}
            <ng-container *ngIf="filterDateEnd"> â€“ {{ filterDateEnd | date:'dd MMM yyyy':'':'tr' }}</ng-container>
          </span>
        </ng-container>
        <span *ngIf="filterEmail" class="chip chip--email">{{ filterEmail }}</span>
        <span *ngIf="filterName" class="chip chip--name">{{ filterName }}</span>
      </div>
    </div>

    <!-- â”€â”€ Loading â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div *ngIf="isLoading" class="loading-state">
      <div class="spinner-ring"></div>
      <p class="loading-state__text">Kiralama kayÄ±tlarÄ± yÃ¼kleniyorâ€¦</p>
    </div>

    <!-- â”€â”€ Empty State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div *ngIf="!isLoading && filteredRentals.length === 0" class="empty-state">
      <div class="empty-state__icon">ğŸ“‹</div>
      <p class="empty-state__title">SonuÃ§ bulunamadÄ±</p>
      <p class="empty-state__text">Filtre kriterlerinizi deÄŸiÅŸtirerek tekrar deneyebilirsiniz.</p>
    </div>

    <!-- â”€â”€ Results â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <ng-container *ngIf="!isLoading && filteredRentals.length > 0">
      <div class="results-bar">
        <p class="results-bar__count">
          <span>{{ filteredRentals.length }}</span> kiralama kaydÄ± listeleniyor
        </p>
      </div>

      <div class="rental-grid">
        <div class="rental-card" *ngFor="let rental of filteredRentals">

          <!-- Car image + status pill -->
          <div class="card-media">
            <img src="assets/images/lux.jpg" alt="{{ rental.brandName }}" (error)="setDefaultImage($event)" />
            <span
              [class]="rental.status === 2 ? 'card-status card-status--returned' : 'card-status card-status--active'">
              {{ rental.status === 2 ? 'âœ“ Teslim Edildi' : rental.status === 1 ? 'â— Aktif' : 'Ä°ptal' }}
            </span>
          </div>

          <div class="card-content">

            <!-- Brand -->
            <div class="card-brand">{{ rental.brandName }} <span style="font-weight:400;color:var(--color-ink-500);">{{
                rental.modelYear }}</span></div>

            <!-- Vehicle specs -->
            <div>
              <p class="card-section-label">AraÃ§ Ã–zellikleri</p>
              <dl class="card-info-table">
                <dt>Renk</dt>
                <dd>{{ rental.colorName }}</dd>
                <dt>Segment</dt>
                <dd>{{ rental.segmentName }}</dd>
                <dt>YakÄ±t</dt>
                <dd>{{ rental.fuelName }}</dd>
                <dt>Vites</dt>
                <dd>{{ rental.gearName }}</dd>
                <dt>GÃ¼nlÃ¼k</dt>
                <dd>{{ rental.rentedDailyPrice | currency:'TRY':'symbol':'1.0-0' }}</dd>
                <dt>Depozito</dt>
                <dd>{{ rental.depositAmount | currency:'TRY':'symbol':'1.0-0' }}</dd>
              </dl>
            </div>

            <hr class="card-divider">

            <!-- Customer info -->
            <div>
              <p class="card-section-label">MÃ¼ÅŸteri</p>
              <ng-container *ngIf="getUserInfo(rental) as info; else noUser">
                <dl class="card-info-table">
                  <dt>Ad</dt>
                  <dd>{{ info.name }}</dd>
                  <dt>E-posta</dt>
                  <dd>{{ info.email }}</dd>
                  <dt>Telefon</dt>
                  <dd>{{ info.phone }}</dd>
                  <dt *ngIf="info.type === 'Individual'">TC</dt>
                  <dd *ngIf="info.type === 'Individual'">{{ info.identityNumber }}</dd>
                  <dt *ngIf="info.type === 'Corporate'">Vergi No</dt>
                  <dd *ngIf="info.type === 'Corporate'">{{ info.taxNumber }}</dd>
                </dl>
              </ng-container>
              <ng-template #noUser>
                <p style="font-size:0.8125rem;color:var(--color-ink-500);">YÃ¼kleniyorâ€¦</p>
              </ng-template>
            </div>

            <hr class="card-divider">

            <!-- Rental dates & locations -->
            <div>
              <p class="card-section-label">Kiralama DetaylarÄ±</p>
              <dl class="card-info-table">
                <dt>BaÅŸlangÄ±Ã§</dt>
                <dd>{{ formatDate(rental.startDate) }}</dd>
                <dt>BitiÅŸ</dt>
                <dd>{{ formatDate(rental.endDate) }}</dd>
                <dt>AlÄ±ÅŸ</dt>
                <dd>
                  <a class="location-link" [routerLink]="['/branches']"
                    [queryParams]="{location: rental.startLocationName}">
                    {{ rental.startLocationName }} â€“ {{ rental.startLocationCity }}
                  </a>
                </dd>
                <dt>BÄ±rakÄ±ÅŸ</dt>
                <dd>
                  <a class="location-link" [routerLink]="['/branches']"
                    [queryParams]="{location: rental.endLocationName}">
                    {{ rental.endLocationName }} â€“ {{ rental.endLocationCity }}
                  </a>
                </dd>
              </dl>
            </div>
          </div>

          <!-- Footer strip -->
          <div class="card-footer-strip">
            <span class="card-footer-strip__meta">#{{ rental.id }} Â· {{ rental.startLocationName }}</span>
            <div class="card-actions">
              <button class="card-action-btn card-action-btn--return" [disabled]="rental.status === 2"
                [title]="rental.status === 2 ? 'Zaten teslim edildi' : 'Teslim alÄ±ndÄ± olarak iÅŸaretle'"
                (click)="confirmReturn(rental)">
                <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"
                  stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="20 6 9 17 4 12" />
                </svg>
                {{ rental.status === 2 ? 'Teslim Edildi' : 'Teslim AlÄ±ndÄ±' }}
              </button>
              <button class="card-action-btn card-action-btn--delete" title="KiralamayÄ± sil"
                (click)="confirmDelete(rental)">
                <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"
                  stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="3 6 5 6 21 6" />
                  <path d="M19 6l-1 14H6L5 6" />
                  <path d="M10 11v6" />
                  <path d="M14 11v6" />
                  <path d="M9 6V4h6v2" />
                </svg>
                Sil
              </button>
            </div>
          </div>

        </div>
      </div>
    </ng-container>

  </div>
</div>